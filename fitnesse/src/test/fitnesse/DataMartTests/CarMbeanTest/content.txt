!contents

There are a couple of FitNesse fixtures that manipulate MBeans.  These tests test those fixtures.

| Import |
| org.jmxdatamart.fixtures |

The CreateMBeans fixture creates a new MBean by invoking its zero-argument constructor and registers the MBean with the given name

!| create MBeans |
| bean class | bean name |
| org.jmxdatamart.JMXTestServer.TestBean | org.jmxdatamart.fitnesse:type=SimpleMBean,forTest=EndToEnd |
| org.jmxdatamart.JMXTestServer.CarBean | org.jmxdatamart.fitnesse:type=CarMXBean,forTest=EndToEnd|

The ConfigureMBeans fixture sets attributes of MBeans. You can configurate the number directly with the SimpleMBean

!| configure MBeans |
| bean name | attribute | value |
| org.jmxdatamart.fitnesse:type=SimpleMBean,forTest=EndToEnd | A | 42 |

For the MXBean, things get a little more interesting. For composite type, you can just call the built-in backdoor to change the name directly

!| configure MBeans |
| bean name | attribute | value |
| org.jmxdatamart.fitnesse:type=CarMXBean,forTest=EndToEnd | CarName | My Dream Call |
| org.jmxdatamart.fitnesse:type=CarMXBean,forTest=EndToEnd | CarEngine | 16 |

For Array type, first invoke setIndex to select what index to change (0..6), then invoke the corresponding function.

!| configure MBeans |
| bean name | attribute | value |
| org.jmxdatamart.fitnesse:type=CarMXBean,forTest=EndToEnd | Index | 3 |
| org.jmxdatamart.fitnesse:type=CarMXBean,forTest=EndToEnd | IndexedInt | 1337 |
| org.jmxdatamart.fitnesse:type=CarMXBean,forTest=EndToEnd | IndexedString | BOOM headshot |
| org.jmxdatamart.fitnesse:type=CarMXBean,forTest=EndToEnd | IndexedCarName | Aston Martin DB5 |

In the above example I just changed intArr[3] to 1337, StrArr[3] to "BOOM headshot", and the name of the car in the index 3 to "Aston Martin DB5".

Finally, for Tabular type, first invoke setKey to select the key of the mapping, then invoke setKeyed(...) to actually change the value (new mapping will be created if not yet exists)

!| configure MBeans |
| bean name | attribute | value |
| org.jmxdatamart.fitnesse:type=CarMXBean,forTest=EndToEnd | Key | Aston Martin |
| org.jmxdatamart.fitnesse:type=CarMXBean,forTest=EndToEnd | KeyedName | DBS V12 |

Just like that. Notice that if you add more mapping into Tabular data, the amount of columns in the final table would also change, and some tests may fail.

The ValidateMBeans fixture tests to make sure that MBeans have the expected values

!| validate MBeans |
| bean name | attribute | value? |
| org.jmxdatamart.fitnesse:type=SimpleMBean,forTest=EndToEnd | A | 42 |

|Extract And Load Everything|
|Extract Using Settings|fitnesse/settings2.xml|
|Load With Settings| fitnesse/loaderConfig.ini | From | fitnesse/extracted/ | URL | ${derby.url} | User Name | ${derby.username} | Password | ${derby.username}|

Now go to simpleDerbyTest and write your own query.